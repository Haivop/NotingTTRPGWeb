import { PartialType } from '@nestjs/mapped-types';
import { CreateWorldItemDto } from './create-world-item.dto';
import { IsOptional, IsString, IsArray, ValidateIf } from 'class-validator';
import { Transform } from 'class-transformer';

export class UpdateWorldItemDto extends PartialType(CreateWorldItemDto) {
  // 1. –û–°–ù–û–í–ù–Ü –¢–ï–ö–°–¢–û–í–Ü –ü–û–õ–Ø
  @IsOptional()
  @IsString()
  name?: string;

  @IsOptional()
  payload?: Record<string, unknown>;

  // 2. –ü–û–õ–Ø, –ü–û–í'–Ø–ó–ê–ù–Ü –ó –§–ê–ô–õ–ê–ú–ò, –Ø–ö–Ü –ü–†–ò–•–û–î–Ø–¢–¨ –ß–ï–†–ï–ó @BODY

  // üü¢ EXISTING GALLERY IMAGES (–ú–∞—Å–∏–≤ —ñ–º–µ–Ω —Ñ–∞–π–ª—ñ–≤ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è)
  // –¶–µ –ø–æ–ª–µ –º—ñ—Å—Ç–∏—Ç—å —ñ–º–µ–Ω–∞ —Ñ–∞–π–ª—ñ–≤ —ñ –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ –≤ DTO
  @IsOptional()
  @IsArray()
  @IsString({ each: true })

  // üü¢ –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è —Ä—è–¥–∫–∞ –≤ –º–∞—Å–∏–≤
  @Transform(({ value }) => {
    // –Ø–∫—â–æ –∑–Ω–∞—á–µ–Ω–Ω—è —î —Ä—è–¥–∫–æ–º (–≤–∏–ø–∞–¥–æ–∫ –æ–¥–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞), –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –π–æ–≥–æ –Ω–∞ [—Ä—è–¥–æ–∫].
    // –Ü–Ω–∞–∫—à–µ (—è–∫—â–æ —Ü–µ –≤–∂–µ –º–∞—Å–∏–≤ –∞–±–æ null/undefined), –∑–∞–ª–∏—à–∏—Ç–∏ —è–∫ —î.
    if (typeof value === 'string') {
      // –î–ª—è –≥–∞–ª–µ—Ä–µ—ó, Multer –º–æ–∂–µ –ø–µ—Ä–µ–¥–∞—Ç–∏ –∫–æ–º—É (—è–∫—â–æ —ó—Ö –±—É–ª–æ –∫—ñ–ª—å–∫–∞), –∞–ª–µ
      // –≤ –Ω–∞—à–æ–º—É –≤–∏–ø–∞–¥–∫—É —Ü–µ –∑–∞–∑–≤–∏—á–∞–π –æ–¥–∏–Ω –µ–ª–µ–º–µ–Ω—Ç, —è–∫–∏–π —Å—Ç–∞–≤ —Ä—è–¥–∫–æ–º.
      // –©–æ–± –±—É—Ç–∏ –∞–±—Å–æ–ª—é—Ç–Ω–æ –±–µ–∑–ø–µ—á–Ω–∏–º–∏, –º–æ–∂–Ω–∞ —Ä–æ–∑–¥—ñ–ª–∏—Ç–∏ –∑–∞ –∫–æ–º–æ—é, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ,
      // –∞–ª–µ –¥–ª—è –æ–¥–∏–Ω–∏—á–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –æ–±–≥–æ—Ä–Ω—É—Ç–∏:
      return [value];
    }
    return value;
  })
  @ValidateIf((object, value) => value !== undefined)
  existingGalleryImages?: string[];

  // üü¢ image (–û–î–ò–ù–ò–ß–ù–ò–ô –§–ê–ô–õ)
  // –ö–æ–ª–∏ —Ñ–∞–π–ª 'image' –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è, Multer –º–æ–∂–µ –ø–µ—Ä–µ–¥–∞—Ç–∏ –ø—É—Å—Ç–∏–π —Ä—è–¥–æ–∫.
  // –ú–∏ –¥–æ–∑–≤–æ–ª—è—î–º–æ —Ü–µ –ø–æ–ª–µ, –∞–ª–µ –Ω–µ –≤–∏–º–∞–≥–∞—î–º–æ –π–æ–≥–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —è–∫ —Ñ–∞–π–ª—É.
  @IsOptional()
  @IsString()
  image?: string;

  // üü¢ galleryImages (–ú–ê–°–ò–í –§–ê–ô–õ–Ü–í)
  // –¶–µ –ø–æ–ª–µ –º—ñ—Å—Ç–∏—Ç—å —ñ–º–µ–Ω–∞ *–Ω–æ–≤–∏—Ö* —Ñ–∞–π–ª—ñ–≤ —ñ –º–∞—î –±—É—Ç–∏ –≤ DTO.
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  @ValidateIf((object, value) => value !== undefined)
  galleryImages?: string[];

  // 3. –î–û–î–ê–¢–ö–û–í–Ü –ü–û–õ–Ø (—è–∫—â–æ –≤–æ–Ω–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è, –∞–ª–µ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –≤ payload)
  // –Ø–∫—â–æ –≤–∏ –Ω–∞–¥—Å–∏–ª–∞—î—Ç–µ type, worldId —á–∏ —ñ–Ω—à—ñ –ø–æ–ª—è, –¥–æ–¥–∞–π—Ç–µ —ó—Ö —Å—é–¥–∏.
  @IsOptional()
  @IsString()
  type?: string;

  // üí° –¢–£–¢ –¢–ê–ö–û–ñ –ú–ê–Ñ –ë–£–¢–ò –í–ê–® @TRANSFORM, –©–û–ë –ü–ï–†–ï–¢–í–û–†–Æ–í–ê–¢–ò –û–î–ò–ù–û–ß–ù–ò–ô –ï–õ–ï–ú–ï–ù–¢
  // (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–ª—è existingGalleryImages) –ù–ê –ú–ê–°–ò–í.
}
